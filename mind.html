<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint-Style Mind Map with Emojis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive;
        }

        body {
            background-color: #f5f5f5;
            overflow: hidden;
            touch-action: none;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #5d4037;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 1.5rem;
            font-weight: normal;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        button {
            padding: 6px 12px;
            background-color: #8d6e63;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:hover {
            background-color: #a1887f;
            transform: translateY(-1px);
        }

        button.active {
            background-color: #4e342e;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.3);
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        .color-picker input {
            width: 25px;
            height: 25px;
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
        }

        .canvas-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background-color: #fff8e1;
            cursor: crosshair;
        }

        #mindmap-canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .mind-element {
            position: absolute;
            cursor: move;
            user-select: none;
            max-width: 200px;
            padding: 8px;
            border-radius: 15px;
            font-size: 16px;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .mind-element:hover {
            transform: scale(1.05);
            box-shadow: 3px 3px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .selected {
            outline: 2px dashed #5d4037;
            transform: scale(1.05);
            z-index: 100;
        }

        .central-idea {
            font-size: 24px;
            font-weight: bold;
            padding: 15px;
            background-color: #ffab91;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
        }

        .emoji {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .properties-panel {
            position: absolute;
            right: 10px;
            top: 70px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 15px;
            width: 220px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .properties-panel.visible {
            display: flex;
        }

        .properties-panel label {
            font-size: 14px;
            color: #5d4037;
        }

        .properties-panel input[type="text"],
        .properties-panel textarea {
            padding: 8px;
            border: 1px solid #d7ccc8;
            border-radius: 8px;
            font-size: 14px;
        }

        .properties-panel textarea {
            resize: vertical;
            min-height: 60px;
        }

        .properties-panel button {
            width: 100%;
            margin-top: 5px;
        }

        .tool-options {
            display: flex;
            gap: 5px;
            margin-left: 10px;
            align-items: center;
        }

        .tool-options select {
            padding: 5px;
            border-radius: 8px;
            border: 1px solid #8d6e63;
            background-color: #fff;
        }

        .eraser-size-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .eraser-size-slider {
            width: 80px;
        }

        .shape-options {
            position: absolute;
            left: 10px;
            top: 70px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
        }

        .shape-options.visible {
            display: flex;
        }

        .shape-option {
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shape-option:hover {
            background-color: #f0f0f0;
        }

        .shape-icon {
            font-size: 20px;
        }

        .emoji-palette {
            position: absolute;
            left: 10px;
            top: 70px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 10px;
            display: none;
            flex-wrap: wrap;
            gap: 5px;
            width: 250px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
        }

        .emoji-palette.visible {
            display: flex;
        }

        .emoji-option {
            font-size: 24px;
            padding: 5px;
            cursor: pointer;
            border-radius: 5px;
        }

        .emoji-option:hover {
            background-color: #f0f0f0;
            transform: scale(1.2);
        }

        .curve-instructions {
            position: absolute;
            left: 50%;
            top: 10px;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            display: none;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 10px;
            }
            
            .toolbar {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .properties-panel {
                width: 90%;
                right: 5%;
                top: auto;
                bottom: 10px;
            }
            
            .shape-options, .emoji-palette {
                left: 5%;
                top: auto;
                bottom: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>üé® Paint-Style Mind Map</h1>
            <div class="toolbar">
                <button id="pencil-btn" class="active">‚úèÔ∏è Pencil</button>
                <button id="pen-btn">üñãÔ∏è Pen</button>
                <button id="highlighter-btn">üñçÔ∏è Highlighter</button>
                <button id="eraser-btn">üßº Eraser</button>
                <button id="shape-btn">üî∑ Shapes</button>
                <button id="curve-btn">‚åí Curve</button>
                <button id="emoji-btn">üòÄ Emoji</button>
                <button id="text-btn">üî§ Text</button>
                <button id="central-btn">üéØ Central Idea</button>
                <div class="tool-options">
                    <select id="brush-size">
                        <option value="2">Thin</option>
                        <option value="4" selected>Medium</option>
                        <option value="8">Thick</option>
                        <option value="12">Marker</option>
                    </select>
                    <div class="eraser-size-container" id="eraser-size-container" style="display:none">
                        <span>Size:</span>
                        <input type="range" min="5" max="50" value="20" class="eraser-size-slider" id="eraser-size">
                    </div>
                </div>
                <div class="color-picker">
                    <input type="color" id="color-picker" value="#5d4037">
                    <input type="color" id="bg-color-picker" value="#fff8e1">
                </div>
                <button id="save-btn">üíæ Save</button>
                <button id="load-btn">üìÇ Load</button>
                <button id="clear-btn">üóëÔ∏è Clear</button>
            </div>
        </header>
        
        <div class="canvas-container" id="canvas-container">
            <canvas id="mindmap-canvas"></canvas>
            <div class="curve-instructions" id="curve-instructions">
                Click to place points, double-click to finish
            </div>
        </div>
        
        <div class="properties-panel" id="properties-panel">
            <label for="element-text">Text Content:</label>
            <textarea id="element-text"></textarea>
            <label for="element-color">Color:</label>
            <input type="color" id="element-color" value="#5d4037">
            <button id="apply-props">Apply Changes</button>
            <button id="delete-element">Delete Element</button>
        </div>
        
        <div class="shape-options" id="shape-options">
            <div class="shape-option" data-shape="rectangle">
                <span class="shape-icon">‚¨õ</span> Rectangle
            </div>
            <div class="shape-option" data-shape="circle">
                <span class="shape-icon">üîµ</span> Circle
            </div>
            <div class="shape-option" data-shape="triangle">
                <span class="shape-icon">üî∫</span> Triangle
            </div>
            <div class="shape-option" data-shape="line">
                <span class="shape-icon">‚ûñ</span> Line
            </div>
            <div class="shape-option" data-shape="arrow">
                <span class="shape-icon">‚û°Ô∏è</span> Arrow
            </div>
        </div>
        
        <div class="emoji-palette" id="emoji-palette">
            <!-- Emojis will be added dynamically -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = document.getElementById('mindmap-canvas');
            const ctx = canvas.getContext('2d');
            
            // Tool buttons
            const pencilBtn = document.getElementById('pencil-btn');
            const penBtn = document.getElementById('pen-btn');
            const highlighterBtn = document.getElementById('highlighter-btn');
            const eraserBtn = document.getElementById('eraser-btn');
            const shapeBtn = document.getElementById('shape-btn');
            const curveBtn = document.getElementById('curve-btn');
            const emojiBtn = document.getElementById('emoji-btn');
            const textBtn = document.getElementById('text-btn');
            const centralBtn = document.getElementById('central-btn');
            const saveBtn = document.getElementById('save-btn');
            const loadBtn = document.getElementById('load-btn');
            const clearBtn = document.getElementById('clear-btn');
            const brushSize = document.getElementById('brush-size');
            const colorPicker = document.getElementById('color-picker');
            const bgColorPicker = document.getElementById('bg-color-picker');
            const eraserSizeContainer = document.getElementById('eraser-size-container');
            const eraserSizeSlider = document.getElementById('eraser-size');
            const shapeOptions = document.getElementById('shape-options');
            const emojiPalette = document.getElementById('emoji-palette');
            const curveInstructions = document.getElementById('curve-instructions');
            
            // Properties panel
            const propertiesPanel = document.getElementById('properties-panel');
            const elementText = document.getElementById('element-text');
            const elementColor = document.getElementById('element-color');
            const applyPropsBtn = document.getElementById('apply-props');
            const deleteElementBtn = document.getElementById('delete-element');
            
            // State variables
            let currentTool = 'pencil';
            let currentShape = 'rectangle';
            let isDrawing = false;
            let currentPath = [];
            let currentColor = '#5d4037';
            let currentBgColor = '#fff8e1';
            let brushWidth = 4;
            let eraserWidth = 20;
            let selectedElement = null;
            let elements = [];
            let branches = [];
            let centralIdea = null;
            let startX, startY;
            let previewShape = null;
            let curvePoints = [];
            let isDrawingCurve = false;
            
            // Emoji list
            const emojis = [
                "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "üòÇ", "ü§£", "üòä", "üòá",
                "üôÇ", "üôÉ", "üòâ", "üòå", "üòç", "ü•∞", "üòò", "üòó", "üòô", "üòö",
                "üòã", "üòõ", "üòù", "üòú", "ü§™", "ü§®", "üßê", "ü§ì", "üòé", "ü§©",
                "ü•≥", "üòè", "üòí", "üòû", "üòî", "üòü", "üòï", "üôÅ", "‚òπÔ∏è", "üò£",
                "üòñ", "üò´", "üò©", "ü•∫", "üò¢", "üò≠", "üò§", "üò†", "üò°", "ü§¨",
                "ü§Ø", "üò≥", "ü•µ", "ü•∂", "üò±", "üò®", "üò∞", "üò•", "üòì", "ü§ó",
                "ü§î", "ü§≠", "ü§´", "ü§•", "üò∂", "üòê", "üòë", "üò¨", "üôÑ", "üòØ",
                "üò¶", "üòß", "üòÆ", "üò≤", "ü•±", "üò¥", "ü§§", "üò™", "üòµ", "ü§ê",
                "ü•¥", "ü§¢", "ü§Æ", "ü§ß", "üò∑", "ü§í", "ü§ï", "ü§ë", "ü§†", "üòà",
                "üëø", "üëπ", "üë∫", "ü§°", "üí©", "üëª", "üíÄ", "‚ò†Ô∏è", "üëΩ", "üëæ",
                "ü§ñ", "üéÉ", "üò∫", "üò∏", "üòπ", "üòª", "üòº", "üòΩ", "üôÄ", "üòø",
                "üòæ", "üôà", "üôâ", "üôä", "üíã", "üíå", "üíò", "üíù", "üíñ", "üíó",
                "üíì", "üíû", "üíï", "üíü", "‚ù£Ô∏è", "üíî", "‚ù§Ô∏è", "üß°", "üíõ", "üíö",
                "üíô", "üíú", "ü§é", "üñ§", "ü§ç", "üíØ", "üí¢", "üí•", "üí´", "üí¶",
                "üí®", "üï≥Ô∏è", "üí£", "üí¨", "üëÅÔ∏è‚Äçüó®Ô∏è", "üó®Ô∏è", "üóØÔ∏è", "üí≠", "üí§", "üëã",
                "ü§ö", "üñêÔ∏è", "‚úã", "üññ", "üëå", "ü§è", "‚úåÔ∏è", "ü§û", "ü§ü", "ü§ò",
                "ü§ô", "üëà", "üëâ", "üëÜ", "üñï", "üëá", "‚òùÔ∏è", "üëç", "üëé", "‚úä",
                "üëä", "ü§õ", "ü§ú", "üëè", "üôå", "üëê", "ü§≤", "ü§ù", "üôè", "‚úçÔ∏è",
                "üíÖ", "ü§≥", "üí™", "ü¶æ", "ü¶ø", "ü¶µ", "ü¶∂", "üëÇ", "ü¶ª", "üëÉ",
                "üß†", "ü¶∑", "ü¶¥", "üëÄ", "üëÅÔ∏è", "üëÖ", "üëÑ", "üë∂", "üßí", "üë¶",
                "üëß", "üßë", "üë®", "üë©", "üßî", "üßî‚Äç‚ôÄÔ∏è", "üßî‚Äç‚ôÇÔ∏è", "üë±", "üë±‚Äç‚ôÄÔ∏è", "üë±‚Äç‚ôÇÔ∏è",
                "üßì", "üë¥", "üëµ", "üôç", "üôç‚Äç‚ôÄÔ∏è", "üôç‚Äç‚ôÇÔ∏è", "üôé", "üôé‚Äç‚ôÄÔ∏è", "üôé‚Äç‚ôÇÔ∏è", "üôÖ",
                "üôÖ‚Äç‚ôÄÔ∏è", "üôÖ‚Äç‚ôÇÔ∏è", "üôÜ", "üôÜ‚Äç‚ôÄÔ∏è", "üôÜ‚Äç‚ôÇÔ∏è", "üíÅ", "üíÅ‚Äç‚ôÄÔ∏è", "üíÅ‚Äç‚ôÇÔ∏è", "üôã", "üôã‚Äç‚ôÄÔ∏è",
                "üôã‚Äç‚ôÇÔ∏è", "üßè", "üßè‚Äç‚ôÄÔ∏è", "üßè‚Äç‚ôÇÔ∏è", "üôá", "üôá‚Äç‚ôÄÔ∏è", "üôá‚Äç‚ôÇÔ∏è", "ü§¶", "ü§¶‚Äç‚ôÄÔ∏è", "ü§¶‚Äç‚ôÇÔ∏è",
                "ü§∑", "ü§∑‚Äç‚ôÄÔ∏è", "ü§∑‚Äç‚ôÇÔ∏è", "üë®‚Äç‚öïÔ∏è", "üë©‚Äç‚öïÔ∏è", "üë®‚Äçüéì", "üë©‚Äçüéì", "üë®‚Äçüè´", "üë©‚Äçüè´", "üë®‚Äç‚öñÔ∏è",
                "üë©‚Äç‚öñÔ∏è", "üë®‚Äçüåæ", "üë©‚Äçüåæ", "üë®‚Äçüç≥", "üë©‚Äçüç≥", "üë®‚Äçüîß", "üë©‚Äçüîß", "üë®‚Äçüè≠", "üë©‚Äçüè≠", "üë®‚Äçüíº",
                "üë©‚Äçüíº", "üë®‚Äçüî¨", "üë©‚Äçüî¨", "üë®‚Äçüíª", "üë©‚Äçüíª", "üë®‚Äçüé§", "üë©‚Äçüé§", "üë®‚Äçüé®", "üë©‚Äçüé®", "üë®‚Äç‚úàÔ∏è",
                "üë©‚Äç‚úàÔ∏è", "üë®‚ÄçüöÄ", "üë©‚ÄçüöÄ", "üë®‚Äçüöí", "üë©‚Äçüöí", "üëÆ", "üëÆ‚Äç‚ôÄÔ∏è", "üëÆ‚Äç‚ôÇÔ∏è", "üïµÔ∏è", "üïµÔ∏è‚Äç‚ôÄÔ∏è",
                "üïµÔ∏è‚Äç‚ôÇÔ∏è", "üíÇ", "üíÇ‚Äç‚ôÄÔ∏è", "üíÇ‚Äç‚ôÇÔ∏è", "ü•∑", "üë∑", "üë∑‚Äç‚ôÄÔ∏è", "üë∑‚Äç‚ôÇÔ∏è", "ü§¥", "üë∏",
                "üë≥", "üë≥‚Äç‚ôÄÔ∏è", "üë≥‚Äç‚ôÇÔ∏è", "üë≤", "üßï", "ü§µ", "ü§µ‚Äç‚ôÄÔ∏è", "ü§µ‚Äç‚ôÇÔ∏è", "üë∞", "üë∞‚Äç‚ôÄÔ∏è",
                "üë∞‚Äç‚ôÇÔ∏è", "ü§∞", "ü§±", "üë©‚Äçüçº", "üë®‚Äçüçº", "üßë‚Äçüçº", "üëº", "üéÖ", "ü§∂", "üßë‚ÄçüéÑ",
                "ü¶∏", "ü¶∏‚Äç‚ôÄÔ∏è", "ü¶∏‚Äç‚ôÇÔ∏è", "ü¶π", "ü¶π‚Äç‚ôÄÔ∏è", "ü¶π‚Äç‚ôÇÔ∏è", "üßô", "üßô‚Äç‚ôÄÔ∏è", "üßô‚Äç‚ôÇÔ∏è", "üßö",
                "üßö‚Äç‚ôÄÔ∏è", "üßö‚Äç‚ôÇÔ∏è", "üßõ", "üßõ‚Äç‚ôÄÔ∏è", "üßõ‚Äç‚ôÇÔ∏è", "üßú", "üßú‚Äç‚ôÄÔ∏è", "üßú‚Äç‚ôÇÔ∏è", "üßù", "üßù‚Äç‚ôÄÔ∏è",
                "üßù‚Äç‚ôÇÔ∏è", "üßû", "üßû‚Äç‚ôÄÔ∏è", "üßû‚Äç‚ôÇÔ∏è", "üßü", "üßü‚Äç‚ôÄÔ∏è", "üßü‚Äç‚ôÇÔ∏è", "üíÜ", "üíÜ‚Äç‚ôÄÔ∏è", "üíÜ‚Äç‚ôÇÔ∏è",
                "üíá", "üíá‚Äç‚ôÄÔ∏è", "üíá‚Äç‚ôÇÔ∏è", "üö∂", "üö∂‚Äç‚ôÄÔ∏è", "üö∂‚Äç‚ôÇÔ∏è", "üßç", "üßç‚Äç‚ôÄÔ∏è", "üßç‚Äç‚ôÇÔ∏è", "üßé",
                "üßé‚Äç‚ôÄÔ∏è", "üßé‚Äç‚ôÇÔ∏è", "üë®‚Äçü¶Ø", "üë©‚Äçü¶Ø", "üßë‚Äçü¶Ø", "üë®‚Äçü¶º", "üë©‚Äçü¶º", "üßë‚Äçü¶º", "üë®‚Äçü¶Ω", "üë©‚Äçü¶Ω",
                "üßë‚Äçü¶Ω", "üèÉ", "üèÉ‚Äç‚ôÄÔ∏è", "üèÉ‚Äç‚ôÇÔ∏è", "üíÉ", "üï∫", "üï¥Ô∏è", "üëØ", "üëØ‚Äç‚ôÄÔ∏è", "üëØ‚Äç‚ôÇÔ∏è",
                "üßñ", "üßñ‚Äç‚ôÄÔ∏è", "üßñ‚Äç‚ôÇÔ∏è", "üßó", "üßó‚Äç‚ôÄÔ∏è", "üßó‚Äç‚ôÇÔ∏è", "ü§∫", "üèá", "‚õ∑Ô∏è", "üèÇ",
                "üèåÔ∏è", "üèåÔ∏è‚Äç‚ôÄÔ∏è", "üèåÔ∏è‚Äç‚ôÇÔ∏è", "üèÑ", "üèÑ‚Äç‚ôÄÔ∏è", "üèÑ‚Äç‚ôÇÔ∏è", "üö£", "üö£‚Äç‚ôÄÔ∏è", "üö£‚Äç‚ôÇÔ∏è", "üèä",
                "üèä‚Äç‚ôÄÔ∏è", "üèä‚Äç‚ôÇÔ∏è", "‚õπÔ∏è", "‚õπÔ∏è‚Äç‚ôÄÔ∏è", "‚õπÔ∏è‚Äç‚ôÇÔ∏è", "üèãÔ∏è", "üèãÔ∏è‚Äç‚ôÄÔ∏è", "üèãÔ∏è‚Äç‚ôÇÔ∏è", "üö¥", "üö¥‚Äç‚ôÄÔ∏è",
                "üö¥‚Äç‚ôÇÔ∏è", "üöµ", "üöµ‚Äç‚ôÄÔ∏è", "üöµ‚Äç‚ôÇÔ∏è", "ü§∏", "ü§∏‚Äç‚ôÄÔ∏è", "ü§∏‚Äç‚ôÇÔ∏è", "ü§º", "ü§º‚Äç‚ôÄÔ∏è", "ü§º‚Äç‚ôÇÔ∏è",
                "ü§Ω", "ü§Ω‚Äç‚ôÄÔ∏è", "ü§Ω‚Äç‚ôÇÔ∏è", "ü§æ", "ü§æ‚Äç‚ôÄÔ∏è", "ü§æ‚Äç‚ôÇÔ∏è", "ü§π", "ü§π‚Äç‚ôÄÔ∏è", "ü§π‚Äç‚ôÇÔ∏è", "üßò",
                "üßò‚Äç‚ôÄÔ∏è", "üßò‚Äç‚ôÇÔ∏è", "üõÄ", "üõå", "üßë‚Äçü§ù‚Äçüßë", "üë≠", "üë´", "üë¨", "üíè", "üíë",
                "üë™", "üó£Ô∏è", "üë§", "üë•", "ü´Ç", "üë£", "ü¶∞", "ü¶±", "ü¶≥", "ü¶≤",
                "üêµ", "üêí", "ü¶ç", "ü¶ß", "üê∂", "üêï", "ü¶Æ", "üêï‚Äçü¶∫", "üê©", "üê∫",
                "ü¶ä", "ü¶ù", "üê±", "üêà", "üêà‚Äç‚¨õ", "ü¶Å", "üêØ", "üêÖ", "üêÜ", "üê¥",
                "üêé", "ü¶Ñ", "ü¶ì", "ü¶å", "ü¶¨", "üêÆ", "üêÇ", "üêÉ", "üêÑ", "üê∑",
                "üêñ", "üêó", "üêΩ", "üêè", "üêë", "üêê", "üê™", "üê´", "ü¶ô", "ü¶í",
                "üêò", "ü¶£", "ü¶è", "ü¶õ", "üê≠", "üêÅ", "üêÄ", "üêπ", "üê∞", "üêá",
                "üêøÔ∏è", "ü¶´", "ü¶î", "ü¶á", "üêª", "üêª‚Äç‚ùÑÔ∏è", "üê®", "üêº", "ü¶•", "ü¶¶",
                "ü¶®", "ü¶ò", "ü¶°", "üêæ", "ü¶É", "üêî", "üêì", "üê£", "üê§", "üê•",
                "üê¶", "üêß", "üïäÔ∏è", "ü¶Ö", "ü¶Ü", "ü¶¢", "ü¶â", "ü¶§", "ü™∂", "ü¶©",
                "ü¶ö", "ü¶ú", "üê∏", "üêä", "üê¢", "ü¶é", "üêç", "üê≤", "üêâ", "ü¶ï",
                "ü¶ñ", "üê≥", "üêã", "üê¨", "ü¶≠", "üêü", "üê†", "üê°", "ü¶à", "üêô",
                "üêö", "ü™∏", "ü™º", "üêå", "ü¶ã", "üêõ", "üêú", "üêù", "ü™≤", "üêû",
                "ü¶ó", "ü™≥", "üï∑Ô∏è", "üï∏Ô∏è", "ü¶Ç", "ü¶ü", "ü™∞", "ü™±", "ü¶†", "üíê",
                "üå∏", "üíÆ", "üèµÔ∏è", "üåπ", "ü•Ä", "üå∫", "üåª", "üåº", "üå∑", "üå±",
                "ü™¥", "üå≤", "üå≥", "üå¥", "üåµ", "üåæ", "üåø", "‚òòÔ∏è", "üçÄ", "üçÅ",
                "üçÇ", "üçÉ", "ü™π", "ü™∫", "üçÑ", "üçá", "üçà", "üçâ", "üçä", "üçã",
                "üçå", "üçç", "ü•≠", "üçé", "üçè", "üçê", "üçë", "üçí", "üçì", "ü´ê",
                "ü•ù", "üçÖ", "ü´í", "ü••", "ü•ë", "üçÜ", "ü•î", "ü•ï", "üåΩ", "üå∂Ô∏è",
                "ü´ë", "ü•í", "ü•¨", "ü•¶", "üßÑ", "üßÖ", "ü•ú", "ü´ò", "üå∞", "ü´ö",
                "ü´õ", "üçû", "ü•ê", "ü•ñ", "ü´ì", "ü•®", "ü•Ø", "ü•û", "üßá", "üßÄ",
                "üçñ", "üçó", "ü•©", "ü•ì", "üçî", "üçü", "üçï", "üå≠", "ü•™", "üåÆ",
                "üåØ", "ü´î", "ü•ô", "üßÜ", "ü•ö", "üç≥", "ü•ò", "üç≤", "ü´ï", "ü•£",
                "ü•ó", "üçø", "üßà", "üßÇ", "ü•´", "üç±", "üçò", "üçô", "üçö", "üçõ",
                "üçú", "üçù", "üç†", "üç¢", "üç£", "üç§", "üç•", "ü•Æ", "üç°", "ü•ü",
                "ü•†", "ü•°", "ü¶Ä", "ü¶û", "ü¶ê", "ü¶ë", "ü¶™", "üç¶", "üçß", "üç®",
                "üç©", "üç™", "üéÇ", "üç∞", "üßÅ", "ü•ß", "üç´", "üç¨", "üç≠", "üçÆ",
                "üçØ", "üçº", "ü•õ", "‚òï", "ü´ñ", "üçµ", "üç∂", "üçæ", "üç∑", "üç∏",
                "üçπ", "üç∫", "üçª", "ü•Ç", "ü•É", "ü´ó", "ü•§", "üßã", "üßÉ", "üßâ",
                "üßä", "ü•¢", "üçΩÔ∏è", "üç¥", "ü•Ñ", "üî™", "ü´ô", "üè∫", "üåç", "üåé",
                "üåè", "üåê", "üó∫Ô∏è", "üóæ", "üß≠", "üèîÔ∏è", "‚õ∞Ô∏è", "üåã", "üóª", "üèïÔ∏è",
                "üèñÔ∏è", "üèúÔ∏è", "üèùÔ∏è", "üèûÔ∏è", "üèüÔ∏è", "üèõÔ∏è", "üèóÔ∏è", "üß±", "ü™®", "ü™µ",
                "üõñ", "üèòÔ∏è", "üèöÔ∏è", "üè†", "üè°", "üè¢", "üè£", "üè§", "üè•", "üè¶",
                "üè®", "üè©", "üè™", "üè´", "üè¨", "üè≠", "üèØ", "üè∞", "üíí", "üóº",
                "üóΩ", "‚õ™", "üïå", "üõï", "üïç", "‚õ©Ô∏è", "üïã", "‚õ≤", "‚õ∫", "üåÅ",
                "üåÉ", "üèôÔ∏è", "üåÑ", "üåÖ", "üåÜ", "üåá", "üåâ", "‚ô®Ô∏è", "üé†", "üé°",
                "üé¢", "üíà", "üé™", "üöÇ", "üöÉ", "üöÑ", "üöÖ", "üöÜ", "üöá", "üöà",
                "üöâ", "üöä", "üöù", "üöû", "üöã", "üöå", "üöç", "üöé", "üöê", "üöë",
                "üöí", "üöì", "üöî", "üöï", "üöñ", "üöó", "üöò", "üöô", "üõª", "üöö",
                "üöõ", "üöú", "üèéÔ∏è", "üèçÔ∏è", "üõµ", "ü¶Ω", "ü¶º", "üõ∫", "üö≤", "üõ¥",
                "üõπ", "üõº", "üöè", "üõ£Ô∏è", "üõ§Ô∏è", "üõ¢Ô∏è", "‚õΩ", "üö®", "üö•", "üö¶",
                "üõë", "üöß", "‚öì", "‚õµ", "üõ∂", "üö§", "üõ≥Ô∏è", "‚õ¥Ô∏è", "üõ•Ô∏è", "üö¢",
                "‚úàÔ∏è", "üõ©Ô∏è", "üõ´", "üõ¨", "ü™Ç", "üí∫", "üöÅ", "üöü", "üö†", "üö°",
                "üõ∞Ô∏è", "üöÄ", "üõ∏", "üõéÔ∏è", "üß≥", "‚åõ", "‚è≥", "‚åö", "‚è∞", "‚è±Ô∏è",
                "‚è≤Ô∏è", "üï∞Ô∏è", "üïõ", "üïß", "üïê", "üïú", "üïë", "üïù", "üïí", "üïû",
                "üïì", "üïü", "üïî", "üï†", "üïï", "üï°", "üïñ", "üï¢", "üïó", "üï£",
                "üïò", "üï§", "üïô", "üï•", "üïö", "üï¶", "üåë", "üåí", "üåì", "üåî",
                "üåï", "üåñ", "üåó", "üåò", "üåô", "üåö", "üåõ", "üåú", "üå°Ô∏è", "‚òÄÔ∏è",
                "üåù", "üåû", "ü™ê", "‚≠ê", "üåü", "üå†", "üåå", "‚òÅÔ∏è", "‚õÖ", "‚õàÔ∏è",
                "üå§Ô∏è", "üå•Ô∏è", "üå¶Ô∏è", "üåßÔ∏è", "üå®Ô∏è", "üå©Ô∏è", "üå™Ô∏è", "üå´Ô∏è", "üå¨Ô∏è", "üåÄ",
                "üåà", "üåÇ", "‚òÇÔ∏è", "‚òî", "‚õ±Ô∏è", "‚ö°", "‚ùÑÔ∏è", "‚òÉÔ∏è", "‚õÑ", "‚òÑÔ∏è",
                "üî•", "üíß", "üåä", "üéÑ", "‚ú®", "üéã", "üéç", "üéÉ", "üéÜ", "üéá",
                "üß®", "üéà", "üéâ", "üéä", "üéé", "üéè", "üéê", "üéë", "üßß", "üéÄ",
                "üéÅ", "üéóÔ∏è", "üéüÔ∏è", "üé´", "üéñÔ∏è", "üèÜ", "üèÖ", "ü•á", "ü•à", "ü•â",
                "‚öΩ", "‚öæ", "ü•é", "üèÄ", "üèê", "üèà", "üèâ", "üéæ", "ü•è", "üé≥",
                "üèè", "üèë", "üèí", "ü•ç", "üèì", "üè∏", "ü•ä", "ü•ã", "ü•Ö", "‚õ≥",
                "ü™Å", "üèπ", "üé£", "ü§ø", "üõù", "üéΩ", "üéø", "üõ∑", "ü•å", "üéØ",
                "ü™Ä", "ü™É", "üé±", "üîÆ", "ü™Ñ", "üßø", "üéÆ", "üïπÔ∏è", "üé∞", "üé≤",
                "üß©", "üß∏", "ü™Ö", "ü™Ü", "‚ô†Ô∏è", "‚ô•Ô∏è", "‚ô¶Ô∏è", "‚ô£Ô∏è", "‚ôüÔ∏è", "üÉè",
                "üÄÑ", "üé¥", "üé≠", "üñºÔ∏è", "üé®", "üßµ", "ü™°", "üß∂", "ü™¢", "üëì",
                "üï∂Ô∏è", "ü•Ω", "ü•º", "ü¶∫", "üëî", "üëï", "üëñ", "üß£", "üß§", "üß•",
                "üß¶", "üëó", "üëò", "ü•ª", "ü©±", "ü©≤", "ü©≥", "üëô", "üëö", "üëõ",
                "üëú", "üëù", "üõçÔ∏è", "üéí", "ü©¥", "üëû", "üëü", "ü•æ", "ü•ø", "üë†",
                "üë°", "ü©∞", "üë¢", "üëë", "üëí", "üé©", "üéì", "üß¢", "ü™ñ", "‚õëÔ∏è",
                "üìø", "üíÑ", "üíç", "üíé", "üîá", "üîà", "üîâ", "üîä", "üì¢", "üì£",
                "üìØ", "üîî", "üîï", "üéº", "üéµ", "üé∂", "üéôÔ∏è", "üéöÔ∏è", "üéõÔ∏è", "üé§",
                "üéß", "üìª", "üé∑", "ü™ó", "üé∏", "üéπ", "üé∫", "üéª", "ü™ï", "ü•Å",
                "ü™ò", "üì±", "üì≤", "‚òéÔ∏è", "üìû", "üìü", "üì†", "üîã", "üîå", "üíª",
                "üñ•Ô∏è", "üñ®Ô∏è", "‚å®Ô∏è", "üñ±Ô∏è", "üñ≤Ô∏è", "üíΩ", "üíæ", "üíø", "üìÄ", "üßÆ",
                "üé•", "üéûÔ∏è", "üìΩÔ∏è", "üé¨", "üì∫", "üì∑", "üì∏", "üìπ", "üìº", "üîç",
                "üîé", "üïØÔ∏è", "üí°", "üî¶", "üèÆ", "ü™î", "üìî", "üìï", "üìñ", "üìó",
                "üìò", "üìô", "üìö", "üìì", "üìí", "üìÉ", "üìú", "üìÑ", "üì∞", "üóûÔ∏è",
                "üìë", "üîñ", "üè∑Ô∏è", "üí∞", "ü™ô", "üí¥", "üíµ", "üí∂", "üí∑", "üí∏",
                "üí≥", "üßæ", "üíπ", "‚úâÔ∏è", "üìß", "üì®", "üì©", "üì§", "üì•", "üì¶",
                "üì´", "üì™", "üì¨", "üì≠", "üìÆ", "üó≥Ô∏è", "‚úèÔ∏è", "‚úíÔ∏è", "üñãÔ∏è", "üñäÔ∏è",
                "üñåÔ∏è", "üñçÔ∏è", "üìù", "üíº", "üìÅ", "üìÇ", "üóÇÔ∏è", "üìÖ", "üìÜ", "üóíÔ∏è",
                "üóìÔ∏è", "üìá", "üìà", "üìâ", "üìä", "üìã", "üìå", "üìç", "üìé", "üñáÔ∏è",
                "üìè", "üìê", "‚úÇÔ∏è", "üóÉÔ∏è", "üóÑÔ∏è", "üóëÔ∏è", "üîí", "üîì", "üîè", "üîê",
                "üîë", "üóùÔ∏è", "üî®", "ü™ì", "‚õèÔ∏è", "‚öíÔ∏è", "üõ†Ô∏è", "üó°Ô∏è", "‚öîÔ∏è", "üî´",
                "ü™É", "üèπ", "üõ°Ô∏è", "ü™ö", "üîß", "ü™õ", "üî©", "‚öôÔ∏è", "üóúÔ∏è", "‚öñÔ∏è",
                "ü¶Ø", "üîó", "‚õìÔ∏è", "ü™ù", "üß∞", "üß≤", "ü™ú", "‚öóÔ∏è", "üß™", "üß´",
                "üß¨", "üî¨", "üî≠", "üì°", "üíâ", "ü©∏", "üíä", "ü©π", "ü©∫", "üö™",
                "üõó", "ü™û", "ü™ü", "üõèÔ∏è", "üõãÔ∏è", "ü™ë", "üöΩ", "ü™†", "üöø", "üõÅ",
                "ü™§", "ü™í", "üß¥", "üß∑", "üßπ", "üß∫", "üßª", "ü™£", "üßº", "ü´ß",
                "ü™•", "üßΩ", "üßØ", "üõí", "üö¨", "‚ö∞Ô∏è", "ü™¶", "‚ö±Ô∏è", "üóø", "ü™ß",
                "üèß", "üöÆ", "üö∞", "‚ôø", "üöπ", "üö∫", "üöª", "üöº", "üöæ", "üõÇ",
                "üõÉ", "üõÑ", "üõÖ", "‚ö†Ô∏è", "üö∏", "‚õî", "üö´", "üö≥", "üö≠", "üöØ",
                "üö±", "üö∑", "üìµ", "üîû", "‚ò¢Ô∏è", "‚ò£Ô∏è", "‚¨ÜÔ∏è", "‚ÜóÔ∏è", "‚û°Ô∏è", "‚ÜòÔ∏è",
                "‚¨áÔ∏è", "‚ÜôÔ∏è", "‚¨ÖÔ∏è", "‚ÜñÔ∏è", "‚ÜïÔ∏è", "‚ÜîÔ∏è", "‚Ü©Ô∏è", "‚Ü™Ô∏è", "‚§¥Ô∏è", "‚§µÔ∏è",
                "üîÉ", "üîÑ", "üîô", "üîö", "üîõ", "üîú", "üîù", "üõê", "‚öõÔ∏è", "üïâÔ∏è",
                "‚ú°Ô∏è", "‚ò∏Ô∏è", "‚òØÔ∏è", "‚úùÔ∏è", "‚ò¶Ô∏è", "‚ò™Ô∏è", "‚òÆÔ∏è", "üïé", "üîØ", "‚ôà",
                "‚ôâ", "‚ôä", "‚ôã", "‚ôå", "‚ôç", "‚ôé", "‚ôè", "‚ôê", "‚ôë", "‚ôí",
                "‚ôì", "‚õé", "üîÄ", "üîÅ", "üîÇ", "‚ñ∂Ô∏è", "‚è©", "‚è≠Ô∏è", "‚èØÔ∏è", "‚óÄÔ∏è",
                "‚è™", "‚èÆÔ∏è", "üîº", "‚è´", "üîΩ", "‚è¨", "‚è∏Ô∏è", "‚èπÔ∏è", "‚è∫Ô∏è", "‚èèÔ∏è",
                "üé¶", "üîÖ", "üîÜ", "üì∂", "üì≥", "üì¥", "‚ôÄÔ∏è", "‚ôÇÔ∏è", "‚ößÔ∏è", "‚úñÔ∏è",
                "‚ûï", "‚ûñ", "‚ûó", "‚ôæÔ∏è", "‚ÄºÔ∏è", "‚ÅâÔ∏è", "‚ùì", "‚ùî", "‚ùï", "‚ùó",
                "„Ä∞Ô∏è", "üí±", "üí≤", "‚öïÔ∏è", "‚ôªÔ∏è", "‚öúÔ∏è", "üî±", "üìõ", "üî∞", "‚≠ï",
                "‚úÖ", "‚òëÔ∏è", "‚úîÔ∏è", "‚ùå", "‚ùé", "‚û∞", "‚ûø", "„ÄΩÔ∏è", "‚ú≥Ô∏è", "‚ú¥Ô∏è",
                "‚ùáÔ∏è", "¬©Ô∏è", "¬ÆÔ∏è", "‚Ñ¢Ô∏è", "#Ô∏è‚É£", "*Ô∏è‚É£", "0Ô∏è‚É£", "1Ô∏è‚É£", "2Ô∏è‚É£", "3Ô∏è‚É£",
                "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü", "üî†", "üî°", "üî¢",
                "üî£", "üî§", "üÖ∞Ô∏è", "üÜé", "üÖ±Ô∏è", "üÜë", "üÜí", "üÜì", "‚ÑπÔ∏è", "üÜî",
                "‚ìÇÔ∏è", "üÜï", "üÜñ", "üÖæÔ∏è", "üÜó", "üÖøÔ∏è", "üÜò", "üÜô", "üÜö", "üàÅ",
                "üàÇÔ∏è", "üà∑Ô∏è", "üà∂", "üàØ", "üâê", "üàπ", "üàö", "üà≤", "üâë", "üà∏",
                "üà¥", "üà≥", "„äóÔ∏è", "„äôÔ∏è", "üà∫", "üàµ", "üî¥", "üü†", "üü°", "üü¢",
                "üîµ", "üü£", "üü§", "‚ö´", "‚ö™", "üü•", "üüß", "üü®", "üü©", "üü¶",
                "üü™", "üü´", "‚¨õ", "‚¨ú", "‚óºÔ∏è", "‚óªÔ∏è", "‚óæ", "‚óΩ", "‚ñ™Ô∏è", "‚ñ´Ô∏è",
                "üî∂", "üî∑", "üî∏", "üîπ", "üî∫", "üîª", "üí†", "üîò", "üî≥", "üî≤",
                "üèÅ", "üö©", "üéå", "üè¥", "üè≥Ô∏è", "üè≥Ô∏è‚Äçüåà", "üè≥Ô∏è‚Äç‚ößÔ∏è", "üè¥‚Äç‚ò†Ô∏è", "üá¶üá®", "üá¶üá©",
                "üá¶üá™", "üá¶üá´", "üá¶üá¨", "üá¶üáÆ", "üá¶üá±", "üá¶üá≤", "üá¶üá¥", "üá¶üá∂", "üá¶üá∑", "üá¶üá∏",
                "üá¶üáπ", "üá¶üá∫", "üá¶üáº", "üá¶üáΩ", "üá¶üáø", "üáßüá¶", "üáßüáß", "üáßüá©", "üáßüá™", "üáßüá´",
                "üáßüá¨", "üáßüá≠", "üáßüáÆ", "üáßüáØ", "üáßüá±", "üáßüá≤", "üáßüá≥", "üáßüá¥", "üáßüá∂", "üáßüá∑",
                "üáßüá∏", "üáßüáπ", "üáßüáª", "üáßüáº", "üáßüáæ", "üáßüáø", "üá®üá¶", "üá®üá®", "üá®üá©", "üá®üá´",
                "üá®üá¨", "üá®üá≠", "üá®üáÆ", "üá®üá∞", "üá®üá±", "üá®üá≤", "üá®üá≥", "üá®üá¥", "üá®üáµ", "üá®üá∑",
                "üá®üá∫", "üá®üáª", "üá®üáº", "üá®üáΩ", "üá®üáæ", "üá®üáø", "üá©üá™", "üá©üá¨", "üá©üáØ", "üá©üá∞",
                "üá©üá≤", "üá©üá¥", "üá©üáø", "üá™üá¶", "üá™üá®", "üá™üá™", "üá™üá¨", "üá™üá≠", "üá™üá∑", "üá™üá∏",
                "üá™üáπ", "üá™üá∫", "üá´üáÆ", "üá´üáØ", "üá´üá∞", "üá´üá≤", "üá´üá¥", "üá´üá∑", "üá¨üá¶", "üá¨üáß",
                "üá¨üá©", "üá¨üá™", "üá¨üá´", "üá¨üá¨", "üá¨üá≠", "üá¨üáÆ", "üá¨üá±", "üá¨üá≤", "üá¨üá≥", "üá¨üáµ",
                "üá¨üá∂", "üá¨üá∑", "üá¨üá∏", "üá¨üáπ", "üá¨üá∫", "üá¨üáº", "üá¨üáæ", "üá≠üá∞", "üá≠üá≤", "üá≠üá≥",
                "üá≠üá∑", "üá≠üáπ", "üá≠üá∫", "üáÆüá®", "üáÆüá©", "üáÆüá™", "üáÆüá±", "üáÆüá≤", "üáÆüá≥", "üáÆüá¥",
                "üáÆüá∂", "üáÆüá∑", "üáÆüá∏", "üáÆüáπ", "üáØüá™", "üáØüá≤", "üáØüá¥", "üáØüáµ", "üá∞üá™", "üá∞üá¨",
                "üá∞üá≠", "üá∞üáÆ", "üá∞üá≤", "üá∞üá≥", "üá∞üáµ", "üá∞üá∑", "üá∞üáº", "üá∞üáæ", "üá∞üáø", "üá±üá¶",
                "üá±üáß", "üá±üá®", "üá±üáÆ", "üá±üá∞", "üá±üá∑", "üá±üá∏", "üá±üáπ", "üá±üá∫", "üá±üáª", "üá±üáæ",
                "üá≤üá¶", "üá≤üá®", "üá≤üá©", "üá≤üá™", "üá≤üá´", "üá≤üá¨", "üá≤üá≠", "üá≤üá∞", "üá≤üá±", "üá≤üá≤",
                "üá≤üá≥", "üá≤üá¥", "üá≤üáµ", "üá≤üá∂", "üá≤üá∑", "üá≤üá∏", "üá≤üáπ", "üá≤üá∫", "üá≤üáª", "üá≤üáº",
                "üá≤üáΩ", "üá≤üáæ", "üá≤üáø", "üá≥üá¶", "üá≥üá®", "üá≥üá™", "üá≥üá´", "üá≥üá¨", "üá≥üáÆ", "üá≥üá±",
                "üá≥üá¥", "üá≥üáµ", "üá≥üá∑", "üá≥üá∫", "üá≥üáø", "üá¥üá≤", "üáµüá¶", "üáµüá™", "üáµüá´", "üáµüá¨",
                "üáµüá≠", "üáµüá∞", "üáµüá±", "üáµüá≤", "üáµüá≥", "üáµüá∑", "üáµüá∏", "üáµüáπ", "üáµüáº", "üáµüáæ",
                "üá∂üá¶", "üá∑üá™", "üá∑üá¥", "üá∑üá∏", "üá∑üá∫", "üá∑üáº", "üá∏üá¶", "üá∏üáß", "üá∏üá®", "üá∏üá©",
                "üá∏üá™", "üá∏üá¨", "üá∏üá≠", "üá∏üáÆ", "üá∏üáØ", "üá∏üá∞", "üá∏üá±", "üá∏üá≤", "üá∏üá≥", "üá∏üá¥",
                "üá∏üá∑", "üá∏üá∏", "üá∏üáπ", "üá∏üáª", "üá∏üáΩ", "üá∏üáæ", "üá∏üáø", "üáπüá¶", "üáπüá®", "üáπüá©",
                "üáπüá´", "üáπüá¨", "üáπüá≠", "üáπüáØ", "üáπüá∞", "üáπüá±", "üáπüá≤", "üáπüá≥", "üáπüá¥", "üáπüá∑",
                "üáπüáπ", "üáπüáª", "üáπüáº", "üáπüáø", "üá∫üá¶", "üá∫üá¨", "üá∫üá≤", "üá∫üá≥", "üá∫üá∏", "üá∫üáæ",
                "üá∫üáø", "üáªüá¶", "üáªüá®", "üáªüá™", "üáªüá¨", "üáªüáÆ", "üáªüá≥", "üáªüá∫", "üáºüá´", "üáºüá∏",
                "üáΩüá∞", "üáæüá™", "üáæüáπ", "üáøüá¶", "üáøüá≤", "üáøüáº", "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø", "üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø", "üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å©Û†Å≥Û†Åø"
            ];
            
            // Initialize emoji palette
            emojis.forEach(emoji => {
                const emojiElement = document.createElement('div');
                emojiElement.className = 'emoji-option';
                emojiElement.textContent = emoji;
                emojiElement.addEventListener('click', () => {
                    addEmojiElement(emoji);
                    emojiPalette.classList.remove('visible');
                });
                emojiPalette.appendChild(emojiElement);
            });
            
            // Tool button event listeners
            pencilBtn.addEventListener('click', () => {
                setTool('pencil');
                brushWidth = 2;
            });
            penBtn.addEventListener('click', () => {
                setTool('pen');
                brushWidth = 4;
            });
            highlighterBtn.addEventListener('click', () => {
                setTool('highlighter');
                brushWidth = 12;
                ctx.globalAlpha = 0.5;
            });
            eraserBtn.addEventListener('click', () => {
                setTool('eraser');
                currentColor = currentBgColor;
                brushWidth = eraserWidth;
            });
            shapeBtn.addEventListener('click', () => {
                setTool('shape');
                shapeOptions.classList.toggle('visible');
            });
            curveBtn.addEventListener('click', () => {
                setTool('curve');
                curveInstructions.style.display = 'block';
            });
            emojiBtn.addEventListener('click', () => {
                setTool('emoji');
                emojiPalette.classList.toggle('visible');
            });
            textBtn.addEventListener('click', () => setTool('text'));
            centralBtn.addEventListener('click', () => setTool('central'));
            
            // Brush size
            brushSize.addEventListener('change', (e) => {
                brushWidth = parseInt(e.target.value);
            });
            
            // Eraser size
            eraserSizeSlider.addEventListener('input', (e) => {
                eraserWidth = parseInt(e.target.value);
                if (currentTool === 'eraser') {
                    brushWidth = eraserWidth;
                }
            });
            
            // Color pickers
            colorPicker.addEventListener('input', (e) => {
                currentColor = e.target.value;
                ctx.globalAlpha = 1.0;
            });
            
            bgColorPicker.addEventListener('input', (e) => {
                currentBgColor = e.target.value;
                canvasContainer.style.backgroundColor = currentBgColor;
                if (currentTool === 'eraser') {
                    currentColor = currentBgColor;
                }
            });
            
            // Canvas drawing events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', endDrawing);
            canvas.addEventListener('mouseout', endDrawing);
            canvas.addEventListener('dblclick', finishCurve);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            function handleTouchStart(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
            
            function handleTouchMove(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
            
            function handleTouchEnd(e) {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            }
            
            function startDrawing(e) {
                const pos = getCanvasCoordinates(e);
                
                if (currentTool === 'pencil' || currentTool === 'pen' || currentTool === 'highlighter' || currentTool === 'eraser') {
                    isDrawing = true;
                    currentPath = [{x: pos[0], y: pos[1]}];
                    lastX = pos[0];
                    lastY = pos[1];
                    
                    // Start a new path
                    ctx.beginPath();
                    ctx.moveTo(pos[0], pos[1]);
                    ctx.strokeStyle = currentColor;
                    ctx.lineWidth = brushWidth;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                } else if (currentTool === 'text') {
                    addTextElement(e);
                } else if (currentTool === 'central') {
                    if (!centralIdea) {
                        addCentralIdea(e);
                    }
                } else if (currentTool === 'shape') {
                    startX = pos[0];
                    startY = pos[1];
                    isDrawing = true;
                    previewShape = {
                        type: 'shape',
                        shape: currentShape,
                        x: startX,
                        y: startY,
                        width: 0,
                        height: 0,
                        color: currentColor,
                        lineWidth: brushWidth
                    };
                } else if (currentTool === 'curve') {
                    if (!isDrawingCurve) {
                        isDrawingCurve = true;
                        curvePoints = [{x: pos[0], y: pos[1]}];
                    } else {
                        curvePoints.push({x: pos[0], y: pos[1]});
                    }
                    redrawCanvas();
                    drawCurvePreview();
                } else if (currentTool === 'emoji') {
                    // Handled by emoji palette click
                }
            }
            
            function draw(e) {
                const pos = getCanvasCoordinates(e);
                
                if (isDrawing && (currentTool === 'pencil' || currentTool === 'pen' || currentTool === 'highlighter' || currentTool === 'eraser')) {
                    currentPath.push({x: pos[0], y: pos[1]});
                    
                    // Draw temporary line
                    ctx.lineTo(pos[0], pos[1]);
                    ctx.stroke();
                    
                    // Begin a new path from current position for smoother lines
                    ctx.beginPath();
                    ctx.moveTo(pos[0], pos[1]);
                } else if (currentTool === 'shape' && isDrawing) {
                    // Update preview shape dimensions
                    previewShape.width = pos[0] - startX;
                    previewShape.height = pos[1] - startY;
                    
                    // Redraw canvas with preview
                    redrawCanvas();
                    drawShape(previewShape, true);
                } else if (currentTool === 'curve' && isDrawingCurve && curvePoints.length > 0) {
                    // Update last point for preview
                    curvePoints[curvePoints.length - 1] = {x: pos[0], y: pos[1]};
                    redrawCanvas();
                    drawCurvePreview();
                }
            }
            
            function drawCurvePreview() {
                if (curvePoints.length < 2) return;
                
                ctx.beginPath();
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = brushWidth;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                
                // Draw smooth curve through points
                ctx.moveTo(curvePoints[0].x, curvePoints[0].y);
                for (let i = 1; i < curvePoints.length - 1; i++) {
                    const xc = (curvePoints[i].x + curvePoints[i + 1].x) / 2;
                    const yc = (curvePoints[i].y + curvePoints[i + 1].y) / 2;
                    ctx.quadraticCurveTo(curvePoints[i].x, curvePoints[i].y, xc, yc);
                }
                
                // Draw to the last point if there are at least 2 points
                if (curvePoints.length >= 2) {
                    ctx.lineTo(
                        curvePoints[curvePoints.length - 1].x,
                        curvePoints[curvePoints.length - 1].y
                    );
                }
                
                ctx.stroke();
            }
            
            function drawShape(shape, isPreview = false) {
                ctx.beginPath();
                ctx.strokeStyle = shape.color;
                ctx.lineWidth = shape.lineWidth;
                
                const x = shape.x;
                const y = shape.y;
                const width = shape.width;
                const height = shape.height;
                
                switch(shape.shape) {
                    case 'rectangle':
                        ctx.rect(x, y, width, height);
                        break;
                    case 'circle':
                        const radius = Math.sqrt(width * width + height * height);
                        ctx.arc(x, y, radius, 0, Math.PI * 2);
                        break;
                    case 'triangle':
                        ctx.moveTo(x + width/2, y);
                        ctx.lineTo(x + width, y + height);
                        ctx.lineTo(x, y + height);
                        ctx.closePath();
                        break;
                    case 'line':
                        ctx.moveTo(x, y);
                        ctx.lineTo(x + width, y + height);
                        break;
                    case 'arrow':
                        ctx.moveTo(x, y);
                        ctx.lineTo(x + width, y + height);
                        // Arrowhead
                        const headLength = 15;
                        const angle = Math.atan2(height, width);
                        ctx.lineTo(
                            x + width - headLength * Math.cos(angle - Math.PI/6),
                            y + height - headLength * Math.sin(angle - Math.PI/6)
                        );
                        ctx.moveTo(x + width, y + height);
                        ctx.lineTo(
                            x + width - headLength * Math.cos(angle + Math.PI/6),
                            y + height - headLength * Math.sin(angle + Math.PI/6)
                        );
                        break;
                }
                
                if (isPreview) {
                    ctx.strokeStyle = shape.color + '80'; // Add transparency
                }
                ctx.stroke();
            }
            
            function finishCurve() {
                if (currentTool === 'curve' && isDrawingCurve && curvePoints.length >= 2) {
                    branches.push({
                        type: 'curve',
                        points: [...curvePoints],
                        color: currentColor,
                        width: brushWidth
                    });
                    isDrawingCurve = false;
                    curvePoints = [];
                    curveInstructions.style.display = 'none';
                    redrawCanvas();
                }
            }
            
            function endDrawing() {
                if (!isDrawing && !isDrawingCurve) return;
                
                if (currentTool === 'pencil' || currentTool === 'pen' || currentTool === 'highlighter' || currentTool === 'eraser') {
                    // Save the drawn branch if it has enough points
                    if (currentPath.length > 2) {
                        branches.push({
                            points: currentPath,
                            color: currentColor,
                            width: brushWidth,
                            tool: currentTool
                        });
                    }
                    currentPath = [];
                    isDrawing = false;
                } else if (currentTool === 'shape' && isDrawing) {
                    // Save the shape
                    branches.push({
                        type: 'shape',
                        shape: currentShape,
                        x: previewShape.x,
                        y: previewShape.y,
                        width: previewShape.width,
                        height: previewShape.height,
                        color: currentColor,
                        lineWidth: brushWidth
                    });
                    previewShape = null;
                    isDrawing = false;
                }
                
                redrawCanvas();
            }
            
            function redrawCanvas() {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Redraw all branches and shapes
                branches.forEach(branch => {
                    if (branch.type === 'shape') {
                        drawShape(branch);
                    } else if (branch.type === 'curve') {
                        ctx.beginPath();
                        ctx.strokeStyle = branch.color;
                        ctx.lineWidth = branch.width;
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        
                        // Draw smooth curve through points
                        ctx.moveTo(branch.points[0].x, branch.points[0].y);
                        for (let i = 1; i < branch.points.length - 1; i++) {
                            const xc = (branch.points[i].x + branch.points[i + 1].x) / 2;
                            const yc = (branch.points[i].y + branch.points[i + 1].y) / 2;
                            ctx.quadraticCurveTo(branch.points[i].x, branch.points[i].y, xc, yc);
                        }
                        
                        // Draw to the last point
                        if (branch.points.length >= 2) {
                            ctx.lineTo(
                                branch.points[branch.points.length - 1].x,
                                branch.points[branch.points.length - 1].y
                            );
                        }
                        
                        ctx.stroke();
                    } else if (branch.points && branch.points.length > 1) {
                        ctx.beginPath();
                        ctx.moveTo(branch.points[0].x, branch.points[0].y);
                        
                        for (let i = 1; i < branch.points.length; i++) {
                            ctx.lineTo(branch.points[i].x, branch.points[i].y);
                        }
                        
                        ctx.strokeStyle = branch.color;
                        ctx.lineWidth = branch.width;
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        ctx.stroke();
                    }
                });
            }
            
            function getCanvasCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                return [
                    e.clientX - rect.left,
                    e.clientY - rect.top
                ];
            }
            
            // Add central idea
            function addCentralIdea(e) {
                const [x, y] = getCanvasCoordinates(e);
                
                const element = document.createElement('div');
                element.className = 'mind-element central-idea';
                element.style.left = `${x - 60}px`;
                element.style.top = `${y - 60}px`;
                element.style.color = currentColor;
                element.textContent = 'Central Idea';
                canvasContainer.appendChild(element);
                
                centralIdea = {
                    id: 'central',
                    x: x - 60,
                    y: y - 60,
                    color: currentColor,
                    text: 'Central Idea',
                    element
                };
                
                // Make draggable
                setupElementDrag(element, centralIdea);
                
                // Select the central idea
                selectElement(centralIdea);
            }
            
            // Add text element
            function addTextElement(e) {
                const [x, y] = getCanvasCoordinates(e);
                
                const element = document.createElement('div');
                element.className = 'mind-element';
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
                element.style.color = currentColor;
                element.style.backgroundColor = '#fff8e1';
                element.textContent = 'Double click to edit';
                canvasContainer.appendChild(element);
                
                const elementData = {
                    id: Date.now(),
                    type: 'text',
                    x,
                    y,
                    color: currentColor,
                    bgColor: '#fff8e1',
                    text: 'Double click to edit',
                    element
                };
                
                elements.push(elementData);
                
                // Make draggable
                setupElementDrag(element, elementData);
                
                // Select the new element
                selectElement(elementData);
            }
            
            // Add emoji element
            function addEmojiElement(emoji) {
                const [x, y] = [canvas.width / 2 - 30, canvas.height / 2 - 30];
                
                const element = document.createElement('div');
                element.className = 'mind-element';
                element.style.left = `${x}px`;
                element.style.top = `${y}px`;
                element.style.fontSize = '40px';
                element.style.backgroundColor = 'transparent';
                element.textContent = emoji;
                canvasContainer.appendChild(element);
                
                const elementData = {
                    id: Date.now(),
                    type: 'emoji',
                    x,
                    y,
                    emoji,
                    element
                };
                
                elements.push(elementData);
                
                // Make draggable
                setupElementDrag(element, elementData);
                
                // Select the new element
                selectElement(elementData);
            }
            
            // Setup element dragging
            function setupElementDrag(element, elementData) {
                let isDragging = false;
                let offsetX, offsetY;
                
                element.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    
                    // Select element
                    selectElement(elementData);
                    
                    // Prepare for dragging
                    const rect = element.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                    
                    isDragging = true;
                    element.style.zIndex = '100';
                    element.style.cursor = 'grabbing';
                    
                    document.addEventListener('mousemove', dragElement);
                    document.addEventListener('mouseup', stopDrag);
                });
                
                function dragElement(e) {
                    if (!isDragging) return;
                    
                    const x = e.clientX - offsetX;
                    const y = e.clientY - offsetY;
                    
                    element.style.left = `${x}px`;
                    element.style.top = `${y}px`;
                    
                    // Update position in data
                    elementData.x = x;
                    elementData.y = y;
                }
                
                function stopDrag() {
                    isDragging = false;
                    element.style.zIndex = '';
                    element.style.cursor = 'move';
                    
                    document.removeEventListener('mousemove', dragElement);
                    document.removeEventListener('mouseup', stopDrag);
                }
                
                // Double click to edit text
                if (elementData.type === 'text') {
                    element.addEventListener('dblclick', (e) => {
                        e.stopPropagation();
                        selectElement(elementData);
                        elementText.value = elementData.text;
                        elementColor.value = elementData.color;
                        propertiesPanel.classList.add('visible');
                        elementText.focus();
                    });
                }
            }
            
            // Select element
            function selectElement(elementData) {
                // Deselect previous
                if (selectedElement) {
                    selectedElement.element.classList.remove('selected');
                }
                
                // Select new
                selectedElement = elementData;
                elementData.element.classList.add('selected');
                
                // Update properties panel
                if (elementData.text) {
                    elementText.value = elementData.text;
                }
                if (elementData.color) {
                    elementColor.value = elementData.color;
                }
                
                propertiesPanel.classList.add('visible');
            }
            
            // Properties panel events
            applyPropsBtn.addEventListener('click', () => {
                if (!selectedElement) return;
                
                if (selectedElement.color) {
                    selectedElement.color = elementColor.value;
                    selectedElement.element.style.color = selectedElement.color;
                }
                
                if (selectedElement.text !== undefined) {
                    selectedElement.text = elementText.value;
                    selectedElement.element.textContent = selectedElement.text;
                }
                
                propertiesPanel.classList.remove('visible');
            });
            
            deleteElementBtn.addEventListener('click', () => {
                if (!selectedElement) return;
                
                if (confirm('Delete this element?')) {
                    selectedElement.element.remove();
                    
                    if (selectedElement.id === 'central') {
                        centralIdea = null;
                    } else {
                        elements = elements.filter(el => el.id !== selectedElement.id);
                    }
                    
                    selectedElement = null;
                    propertiesPanel.classList.remove('visible');
                }
            });
            
            // Save and load
            saveBtn.addEventListener('click', () => {
                const data = {
                    elements: elements.map(el => ({
                        type: el.type,
                        x: el.x,
                        y: el.y,
                        color: el.color,
                        bgColor: el.bgColor,
                        text: el.text,
                        emoji: el.emoji
                    })),
                    branches: branches,
                    centralIdea: centralIdea ? {
                        x: centralIdea.x,
                        y: centralIdea.y,
                        color: centralIdea.color,
                        text: centralIdea.text
                    } : null,
                    bgColor: currentBgColor
                };
                
                const dataStr = JSON.stringify(data);
                localStorage.setItem('mindmapData', dataStr);
                alert('Mind map saved!');
            });
            
            loadBtn.addEventListener('click', () => {
                const dataStr = localStorage.getItem('mindmapData');
                if (!dataStr) {
                    alert('No saved mind map found');
                    return;
                }
                
                if (confirm('Load saved mind map? Current work will be lost.')) {
                    const data = JSON.parse(dataStr);
                    
                    // Clear current elements
                    elements.forEach(el => el.element.remove());
                    elements = [];
                    branches = [];
                    if (centralIdea) {
                        centralIdea.element.remove();
                        centralIdea = null;
                    }
                    
                    // Load background color
                    currentBgColor = data.bgColor || '#fff8e1';
                    canvasContainer.style.backgroundColor = currentBgColor;
                    bgColorPicker.value = currentBgColor;
                    
                    // Load central idea
                    if (data.centralIdea) {
                        const element = document.createElement('div');
                        element.className = 'mind-element central-idea';
                        element.style.left = `${data.centralIdea.x}px`;
                        element.style.top = `${data.centralIdea.y}px`;
                        element.style.color = data.centralIdea.color;
                        element.textContent = data.centralIdea.text;
                        canvasContainer.appendChild(element);
                        
                        centralIdea = {
                            id: 'central',
                            x: data.centralIdea.x,
                            y: data.centralIdea.y,
                            color: data.centralIdea.color,
                            text: data.centralIdea.text,
                            element
                        };
                        setupElementDrag(element, centralIdea);
                    }
                    
                    // Load elements
                    data.elements.forEach(elData => {
                        const element = document.createElement('div');
                        element.className = 'mind-element';
                        element.style.left = `${elData.x}px`;
                        element.style.top = `${elData.y}px`;
                        
                        if (elData.type === 'text') {
                            element.style.color = elData.color;
                            element.style.backgroundColor = elData.bgColor || '#fff8e1';
                            element.textContent = elData.text;
                        } else if (elData.type === 'emoji') {
                            element.style.fontSize = '40px';
                            element.style.backgroundColor = 'transparent';
                            element.textContent = elData.emoji;
                        }
                        
                        canvasContainer.appendChild(element);
                        
                        const elementObj = {
                            id: Date.now(),
                            type: elData.type,
                            x: elData.x,
                            y: elData.y,
                            color: elData.color,
                            bgColor: elData.bgColor,
                            text: elData.text,
                            emoji: elData.emoji,
                            element
                        };
                        
                        elements.push(elementObj);
                        setupElementDrag(element, elementObj);
                    });
                    
                    // Load branches
                    branches = data.branches || [];
                    redrawCanvas();
                    
                    alert('Mind map loaded!');
                }
            });
            
            clearBtn.addEventListener('click', () => {
                if (confirm('Clear the entire canvas?')) {
                    // Clear elements
                    elements.forEach(el => el.element.remove());
                    elements = [];
                    branches = [];
                    
                    // Clear central idea
                    if (centralIdea) {
                        centralIdea.element.remove();
                        centralIdea = null;
                    }
                    
                    // Clear canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Reset properties panel
                    propertiesPanel.classList.remove('visible');
                    selectedElement = null;
                }
            });
            
            // Shape selection
            document.querySelectorAll('.shape-option').forEach(option => {
                option.addEventListener('click', () => {
                    currentShape = option.dataset.shape;
                    shapeOptions.classList.remove('visible');
                });
            });
            
            // Set active tool
            function setTool(tool) {
                currentTool = tool;
                
                // Update active button
                pencilBtn.classList.remove('active');
                penBtn.classList.remove('active');
                highlighterBtn.classList.remove('active');
                eraserBtn.classList.remove('active');
                shapeBtn.classList.remove('active');
                curveBtn.classList.remove('active');
                emojiBtn.classList.remove('active');
                textBtn.classList.remove('active');
                centralBtn.classList.remove('active');
                
                // Hide panels
                shapeOptions.classList.remove('visible');
                emojiPalette.classList.remove('visible');
                curveInstructions.style.display = 'none';
                
                // Show eraser size if eraser is selected
                if (tool === 'eraser') {
                    eraserSizeContainer.style.display = 'flex';
                    currentColor = currentBgColor;
                    brushWidth = eraserWidth;
                } else {
                    eraserSizeContainer.style.display = 'none';
                    currentColor = colorPicker.value;
                    ctx.globalAlpha = 1.0;
                }
                
                // Set active button
                if (tool === 'pencil') pencilBtn.classList.add('active');
                else if (tool === 'pen') penBtn.classList.add('active');
                else if (tool === 'highlighter') highlighterBtn.classList.add('active');
                else if (tool === 'eraser') eraserBtn.classList.add('active');
                else if (tool === 'shape') shapeBtn.classList.add('active');
                else if (tool === 'curve') curveBtn.classList.add('active');
                else if (tool === 'emoji') emojiBtn.classList.add('active');
                else if (tool === 'text') textBtn.classList.add('active');
                else if (tool === 'central') centralBtn.classList.add('active');
            }
            
            // Close properties panel when clicking outside
            document.addEventListener('click', (e) => {
                if (!propertiesPanel.contains(e.target) && 
                    !(selectedElement && selectedElement.element.contains(e.target))) {
                    propertiesPanel.classList.remove('visible');
                }
                
                if (!shapeOptions.contains(e.target) && e.target !== shapeBtn) {
                    shapeOptions.classList.remove('visible');
                }
                
                if (!emojiPalette.contains(e.target) && e.target !== emojiBtn) {
                    emojiPalette.classList.remove('visible');
                }
            });
            
            // Initialize canvas size
            function resizeCanvas() {
                canvas.width = canvasContainer.offsetWidth;
                canvas.height = canvasContainer.offsetHeight;
                redrawCanvas();
            }
            
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            
            // Set initial tool
            setTool('pencil');
        });
    </script>
</body>
</html>